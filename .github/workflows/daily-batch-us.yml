name: US Market Daily Update
# ì„¤ëª…: ë¯¸êµ­ ì‹œì¥ ì „ìš© (ë§¤ì¼ í•œêµ­ì‹œê°„ ì•„ì¹¨ 7ì‹œ 10ë¶„ ì‹¤í–‰)

on:
Â  schedule:
Â  Â  - cron: '10 22 * * *' # UTC 22:10 = KST 07:10
Â  workflow_dispatch:

jobs:
Â  us-daily-routine:
Â  Â  runs-on: ubuntu-latest
Â  Â  steps:
Â  Â  Â  - name: Wake up Server
Â  Â  Â  Â  run: curl https://quantgravity-backend.onrender.com/ 

Â  Â  Â  # 1. ë§ˆìŠ¤í„° ë™ê¸°í™” (ì¢…ëª© -> ì¸ë±ìŠ¤ ìˆœì„œ)
Â  Â  Â  - name: Sync Ticker Master
Â  Â  Â  Â  run: |
Â  Â  Â  Â  Â  echo "ğŸ“‡ [US] ì¢…ëª© ë§ˆìŠ¤í„° ë™ê¸°í™” ì‹œì‘..."
Â  Â  Â  Â  Â  curl -X POST https://quantgravity-backend.onrender.com/api/fmp/sync-ticker-master \
Â  Â  Â  Â  Â  -H "Content-Type: application/json" \
Â  Â  Â  Â  Â  -H "x-batch-key: ${{ secrets.BATCH_SECRET_KEY }}"

Â  Â  Â  - name: Sync Index Master
Â  Â  Â  Â  run: |
Â  Â  Â  Â  Â  echo "ğŸ“ˆ [US] ì¸ë±ìŠ¤ ë§ˆìŠ¤í„° ë™ê¸°í™” ì‹œì‘..."
Â  Â  Â  Â  Â  curl -X POST https://quantgravity-backend.onrender.com/api/fmp/sync-index-master \
Â  Â  Â  Â  Â  -H "Content-Type: application/json" \
Â  Â  Â  Â  Â  -H "x-batch-key: ${{ secrets.BATCH_SECRET_KEY }}"

Â  Â  Â  # 2. ë¯¸êµ­ ì£¼ê°€ ì—…ë°ì´íŠ¸
Â  Â  Â  - name: US Stock Price Update
Â  Â  Â  Â  timeout-minutes: 15
Â  Â  Â  Â  run: |
Â  Â  Â  Â  Â  echo "ğŸš€ [US] ë¯¸êµ­ ì‹œì¥ ì£¼ê°€ ì—…ë°ì´íŠ¸ ì‹œì‘..."
Â  Â  Â  Â  Â  curl -X POST https://quantgravity-backend.onrender.com/api/fmp/daily-update-all \
Â  Â  Â  Â  Â  -H "Content-Type: application/json" \
Â  Â  Â  Â  Â  -H "x-batch-key: ${{ secrets.BATCH_SECRET_KEY }}" \
Â  Â  Â  Â  Â  -d '{"days": 3, "market": "US"}' 

Â  Â  Â  # [ì¶”ê°€í•  ë¶€ë¶„] 5ë¶„(300ì´ˆ) ëŒ€ê¸°í•˜ì—¬ ë°±ê·¸ë¼ìš´ë“œ ë°ì´í„° ì €ì¥ì´ ëë‚  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¼
Â  Â  Â  - name: Wait for DB Sync
Â  Â  Â  Â  run: sleep 300

Â  Â  Â  # 3. í†µê³„ ê°±ì‹ 
Â  Â  Â  - name: Update Market Stats
Â  Â  Â  Â  run: |
Â  Â  Â  Â  Â  echo "ğŸ“Š [US] ë¯¸êµ­ ì‹œì¥ í†µê³„ ì§‘ê³„ ì‹œì‘..."
Â  Â  Â  Â  Â  curl -X POST https://quantgravity-backend.onrender.com/api/batch/update-stats \
Â  Â  Â  Â  Â  -H "Content-Type: application/json" \
Â  Â  Â  Â  Â  -H "x-batch-key: ${{ secrets.BATCH_SECRET_KEY }}" \
Â  Â  Â  Â  Â  -d '{"country": "US"}'